<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b132b; --panel:#1c2541; --accent:#5bc0be; --text:#eaeaea; --muted:#a0a4b8; }
    body { margin:0; background:var(--bg); color:var(--text); font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .chat { max-width:900px; margin:0 auto; height:100dvh; display:flex; flex-direction:column; }
    header { padding:12px 16px; background:var(--panel); display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #2a335a; }
    header h1 { margin:0; font-size:16px; font-weight:600; }
    #status { font-size:12px; color:var(--muted); }
    #messages { list-style:none; margin:0; padding:16px; gap:10px; display:flex; flex-direction:column; overflow:auto; flex:1; }
    .msg { max-width:80%; padding:10px 12px; border-radius:10px; white-space:pre-wrap; word-break:break-word; }
    .me { align-self:flex-end; background:rgba(91,192,190,.15); border:1px solid rgba(91,192,190,.35); }
    .bot { align-self:flex-start; background:#121836; border:1px solid #2a335a; }
    .meta { display:block; font-size:11px; color:var(--muted); margin-bottom:4px; }
    form { display:flex; gap:8px; padding:12px 16px; background:var(--panel); border-top:1px solid #2a335a; }
    input[type="text"] { flex:1; padding:12px; border-radius:8px; border:1px solid #2a335a; background:#0e1633; color:var(--text); outline:none; }
    button { padding:12px 16px; border-radius:8px; border:1px solid #2a335a; background:var(--accent); color:#05171a; font-weight:600; cursor:pointer; }
  </style>
</head>
<body>
  <div class="chat">
    <header>
      <h1>Chatbot</h1>
      <div id="status">Connectingâ€¦</div>
    </header>

    <ul id="messages"></ul>

    <form id="form" autocomplete="off">
      <input id="input" type="text" placeholder="Type your message and press Enter" />
      <button type="submit">Send</button>
    </form>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
  <script>
    // Change to your server URL. For local: 'http://localhost:3000'
    const SOCKET_URL = 'https://mytym.in'; // or 'https://mytym.in'
    const SOCKET_PATH = '/socket.io';

    const messagesEl = document.getElementById('messages');
    const statusEl = document.getElementById('status');
    const formEl = document.getElementById('form');
    const inputEl = document.getElementById('input');

    function addMessage(who, text) {
      const li = document.createElement('li');
      li.className = `msg ${who === 'me' ? 'me' : 'bot'}`;
      const meta = document.createElement('span');
      meta.className = 'meta';
      meta.textContent = who === 'me' ? 'You' : 'Assistant';
      li.appendChild(meta);
      li.appendChild(document.createTextNode(text));
      messagesEl.appendChild(li);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    const socket = io(SOCKET_URL, {
      path: SOCKET_PATH,
      transports: ['websocket', 'polling'],
      reconnection: true,
      reconnectionAttempts: Infinity,
      reconnectionDelay: 1000
    });

    socket.on('connect', () => {
      statusEl.textContent = `Connected (#${socket.id})`;
    });

    socket.on('disconnect', (reason) => {
      statusEl.textContent = `Disconnected (${reason})`;
    });

    socket.on('connect_error', (err) => {
      statusEl.textContent = `Error: ${err.message}`;
    });

    // Receive assistant reply { response: string }
    socket.on('bot_response', ({ response }) => {
      const text = typeof response === 'string' ? response : JSON.stringify(response);
      if (text) addMessage('bot', text);
    });

    // Send user prompt { prompt: string }
    formEl.addEventListener('submit', (e) => {
      e.preventDefault();
      const text = (inputEl.value || '').trim();
      if (!text) return;
      addMessage('me', text);
      socket.emit('user_prompt', { prompt: text });
      inputEl.value = '';
      inputEl.focus();
    });
  </script>
</body>
</html>
